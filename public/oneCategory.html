<!DOCTYPE html>
<html lang="en">
    <script defer src=" https://use.fontawesome.com/releases/v5.0.10/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Serif">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Boogaloo">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Economica:700,400italic">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<style>
    body{
      font-family:  monospace;
      background-color: #eee;
    }
    
</style>
    <link rel="stylesheet" type="text/css" href="/cssFiles/style.css">

</head>
<body>
<!--start of navbar-->
<nav class="navbar navbar-expand-md navbar-light">
    <button class="navbar-toggler ml-auto mb-2 bg-light" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" >
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="container-fluid">
        <div class="row">
          <!--sidebar-->
          <div class="col-xl-2 col-lg-3 col-md-4 sidebar fixed-top">
              <a href="#" class="navbar-brand text-white d-block mx-auto text-center py-3 mb-4 bottom-border"> Good Reads </a>
              <div class="bottom-border">
                <a href="#" class="text-white d-block  text-center ">Fatma Ali</a>
              </div>
              <ul class="navbar-nav flex-column mt-4">
                  <li class="nav-item">
                      <a href="/categoryUser.html" class="nav-link text-white p-3 mb-2 sidebar-link">
                          <i class="fas fa-table text-light fa-lg mr-3">  
                          </i>Categories
                      </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-white p-3 mb-2 sidebar-link">
                            <i class="fas fa-file-alt text-light fa-lg mr-3">  
                            </i>Books
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-white p-3 mb-2 sidebar-link">
                            <i class="fas fa-users text-light fa-lg mr-3">  
                            </i>Authors
                        </a>
                    </li>
              </ul>
          </div>
          <!--end sidebar-->
           <!--start top nav-->
          <div class="col-xl-10 col-lg-9 col-md-8 ml-auto bg-dark fixed-top py-2 top-navbar">
            <div class="row align-item-center">
              <div class="col-md-4">
                  <h4 class="text-light  text-uppercase mb-0">Home</h4>
              </div>
                <div class="col-md-8 text-left">
                  <ul class="navbar-nav">
                      <li class="nav-item ml-md-auto ">
                          <a href="#" class="nav-link" data-toggle="modal" data-target="#sign-out">
                          <i class="fas fa-sign-out-alt text-danger fa-lg"></i>
                          </a>
                      </li>
                  </ul>
                </div>
            </div>
          </div>
          <!--end of top-nav-->
        </div>
      </div>
    </div>
  </nav>
<!--end of navbar-->
<!--start model-->
<div class="modal fade" id="sign-out">
   <div class="modal-dialog">
     <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Want to leave?</h4>
            <button type="button" class="close" data-dismiss="modal">&times;
            </button>
          </div>
          <div class="modal-body">
              Press logout to leave
          </div>
          <div class="modal-footer">
               <button type="button" class="btn btn-success" data-dismiss="modal">Stay Here</button>
               <button type="button" class="btn btn-danger" data-dismiss="modal">Logout</button>
          </div>
     </div>
   </div>
</div>
<!--end model-->
 <!-- The Modal Input Categories-->
 <div class="modal fade" id="myModalCategories">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
    
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Modal Heading</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      
      <!-- Modal body -->
      <div class="modal-body">
        <input type="text" class="form-control" placeholder="Category" name="Categories">
      </div>
      
      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal">Add</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
      </div>
      
    </div>
  </div>
</div>
<!--end of model-->
 <div class="container-fluid">
    <div class="row">
        <div class=" col-xl-10 col-lg-9  col-md-8 ml-auto">
            <div class="row pt-5 mt-3 mb-5">
               <div class="col-xl-3 col-sm-6 p-2" id="card-container">
                 </div>
            </div>
        </div>
    </div>
</div>
<!--<a id="test" class="text-center" href="">fat</a>-->
      </div>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
   
    <script>
 $(document).ready(function () {
     const options = {
            method: 'get',
            headers: {
                'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8'
            }
        }
  //  const urlParams = window.location.pathname
  //  const myParam = urlParams.get('id');    
  var urlParams = window.location.href;
  var page = urlParams.substring(urlParams.lastIndexOf('/') + 1);
   console.log(urlParams);
  console.log(page);
     
    const url = "/category/"+page
   // const url =urlParams
    let cardContainer;
    let createTaskCard = (task) => {
      let card = document.createElement('div');
      card.className = 'card  text-white  text-center';
      card.style="max-width: 15rem;height: 3rem;padding-bottom:3.5rem;margin-bottom:1rem;"
      let cardBody = document.createElement('div');
      cardBody.className = 'card-body';
      let bookName = document.createElement('a');
      bookName.innerText = task.bookName;
      bookName.className = 'card-title';
      let authName = document.createElement('a');
      authName.innerText = task.authName;
      authName.className = 'card-body';
      authName.addEventListener("click", function(){
    //  for (let index = 0; index < task.length; index++) {
     /*  let url = `/category/${task._id}`
        fetch(url, options)
        .then(response => response.text())
        .then((text) => {
              title.href=`/category/categoryhtml/${task._id}`
              localStorage.setItem('key', `${task._id}`);
              console.log(`/category/${localStorage.getItem('key')}`);
              
            })
        .catch(function(error) {
            if (error.name === 'AbortError') {
          console.error('Fetch aborted')
        } else {
          console.error('Another error', error)
        }
      });*/
      //  }
      })
      cardBody.appendChild(authName);
      cardBody.appendChild(bookName);
      card.appendChild(cardBody);
      cardContainer.appendChild(card);
      }
 
//progressive app
    fetch(url, options)
    .then(response => response.json())
    .then(categoryNames => {
       //   $("a").attr("href",`/${JSON.parse(text).url}`);
      //  console.log(categoryNames);
      //  console.log(categoryNames.bookObj.myBooks)

   //  console.log(typeof categoryNames);
     let initListOfTasks = () => {
    if (cardContainer) {
        document.getElementById('card-container').replaceWith(cardContainer);
        return;
    }
    cardContainer = document.getElementById('card-container');
      categoryNames.bookObj.myBooks.forEach((task) => {
          createTaskCard(task);
         // console.log(task);
      });
     };
     initListOfTasks()
    })
    .catch(function(error) {
        if (error.name === 'AbortError') {
      console.error('Fetch aborted')
     } else {
      console.error('Another error', error)
    }
  });   
  })
     

    </script>
</body>
</html>